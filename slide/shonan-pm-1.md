# エンジニア育成に効くかもしれないレイヤードアーキテクチャーっぽいコンポーネント設計

@ytnobody

---

# ytnobody

![ytnobody](https://pbs.twimg.com/profile_images/845351145790877696/zeXOPGY4_200x200.jpg)

---

## ytnobody

- as known as わいとん
- Satoshi Azuma
- CEO of Y.pm LLC.

---

## Agenda

- レイヤードアーキテクチャーの概要
- エンジニア育成のむずかしさ
- Y.pm流のレイヤードアーキテクチャー
- まとめ

---

# レイヤードアーキテクチャーの概要

---

## レイヤードアーキテクチャー

- DDD(ドメイン駆動設計)の文脈でよく引き合いに出る
  - 今回はDDDについては触れないし説明もしない
- レイヤーを分けてアプリケーションを設計する
- レイヤー間の依存関係は一方向にする
- 依存関係の方向は外側から内側に向かう

---

## よくある図

<div class="r-stack">
  <img src="image.png" height="300px">
</div>

---

## レイヤーの種類

- Presentation または UI
  - ユーザーとのやりとりを担当する
- Application
  - ユースケースを実装する
- Domain
  - ドメインモデルを実装する
- Infrastructure
  - データベースや外部サービスとのやりとりを担当する

---

## ここまでがよくあるレイヤードアーキテクチャー

---

## 個人的な所感

- 用語がわかりにくい
  - 例えば「ドメインモデル」
  - 例えば「ユースケース」
- 用語がわかりにくいので、使い方や実装がわからん

---

# エンジニア育成のむずかしさ

---

# ~エンジニア育成~オブジェクト指向プログラミングのむずかしさ

---

## オブジェクト指向プログラミングが難しい

- 種類が色々
  - クラスベース
  - プロトタイプベース
  - マルチパラダイム

---

## インスタンス内部に状態を持つことの難解さ

- アクセス権（ない言語もある）
- メソッドの呼び出し順序
  - メソッドの呼び出し順序による結果の変化
- メソッドの呼び出し順序を制御することの難しさ
  - メソッドの呼び出し順序を制御することの難しさによる結果の変化

---

## インスタンス間の状態の共有の難解さ

- インスタンス間の状態による結果の変化
- インスタンス間の状態を制御することの難しさ
  - インスタンス間の状態を制御することの難しさによる結果の変化

---

## 継承の難解さ

- 最近は継承を使わない方がいいという言説もある
- 実際継承は難しい
  - 多重継承
  - ダイヤモンド継承
  - プロトタイプベースの継承

---

## 移譲をしても難しい

- 移譲をすると、移譲先のインスタンスの状態によって結果が変わる
- 移譲先のインスタンスの状態を制御することの難しさによる結果の変化

---

## まとめると

- オブジェクト指向プログラミングは状態を内包するので難しい
- 状態を内包すると、状態によって結果が変わるので難しい
- 状態を制御することがそもそも難解
- 移譲・継承・状態内包・アクセス権など多機能ゆえに難しい
- あと、思っている以上にクラスの流用は行われない

---

## 初学者を採用して育てるのであれば

- いっそオブジェクト指向プログラミングを捨てて良いのでは？
- 手続き型 + 名前空間でいいのでは？
- そもそもオブジェクト指向プログラミングは難しいので、初学者には向かない
- 状態を内包した変数を捨てることで、初学者がプログラミングを学ぶのに必要な概念を減らせるのでは？

---

# Y.pm流のレイヤードアーキテクチャー

---

## 特徴

- オブジェクト指向プログラミングの手法を捨てた
- 状態を内包した変数を捨てた
- 純粋関数と非純粋関数とデータ構造を明確に分離した
- レイヤー間の依存関係を徹底的に一方向にした

---

## レイヤーの種類

- Handler
  - 呼出し可能な機能のルーティングを担当する
- Service
  - 非純粋関数で構成される機能を実装する
- Domain
  - 純粋関数で構成される機能を実装する
- Infra
  - 外部サービスとのやりとりを担当する

---

## レイヤーの依存関係

<div class="r-stack">
  <img src="image-1.png" height="300px">
</div>

---

## コード例

demo time

---

## まとめ

- オブジェクト指向プログラミングの難しさを回避できる
- 純粋関数と非純粋関数とデータ構造を明確に分離できる
- レイヤー間の依存関係を徹底的に一方向にできる
- これらの特徴は初学者にも優しい。エンジニア育成にも効く

---

## Any Questions?
